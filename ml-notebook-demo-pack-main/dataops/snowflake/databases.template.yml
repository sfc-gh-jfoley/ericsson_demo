default_db_grants: &default_db_grants
  USAGE:
    - ADMIN
    - DATA_SCIENTIST
  CREATE SCHEMA:
    - ADMIN
    - DATA_SCIENTIST

default_schema_grants: &default_schema_grants
  {% for permission in ['ADD SEARCH OPTIMIZATION','CREATE EXTERNAL TABLE','CREATE FILE FORMAT','CREATE FUNCTION','CREATE MASKING POLICY','CREATE MATERIALIZED VIEW','CREATE PIPE','CREATE PROCEDURE','CREATE ROW ACCESS POLICY','CREATE SEQUENCE','CREATE STAGE','CREATE STREAM','CREATE TABLE','CREATE TAG','CREATE TASK','CREATE VIEW','MODIFY','MONITOR','USAGE', 'CREATE NOTEBOOK', 'CREATE MODEL', 'CREATE DATASET'] %}
  {{permission}}:
    - ADMIN
    - DATA_SCIENTIST
  {%- endfor %}
default_table_grants: &default_table_grants
  {% for permission in ['select','insert','update','delete','truncate'] %}
  {{permission}}:
    - ADMIN
    - DATA_SCIENTIST
  {%- endfor %}

databases:
  ## Main DataOps database.
  ## Its name is generated by scripts in the Reference Project and set here using an environment variable.
  "{{ env.DATAOPS_DATABASE }}":
    comment: This is the main DataOps database for environment {{ env.DATAOPS_ENV_NAME }}
    {% if (env.DATAOPS_ENV_NAME != env.DATAOPS_ENV_NAME_PROD and env.DATAOPS_ENV_NAME != env.DATAOPS_ENV_NAME_QA) %}
    ## Pipelines running in branches that are not master or qa will clone this database from the main production database.
    from_database: "{{ env.DATAOPS_DATABASE_MASTER }}"
    data_retention_time_in_days: 1
    {% endif %}
    ## Grant access to this database
    grants: *default_db_grants
    schemas:
      ANALYTICS:
          comment: Notebooks content.
          grants: *default_schema_grants
          stages:
            S3_LOAD:
              comment: Created to load the data
              url: s3://sfquickstarts/
              file_format: S3_FILE_FORMAT              
              grants:
                ALL PRIVILEGES:
                  - ADMIN
                  - DATA_SCIENTIST
            CITIBIKE_LOAD:
              comment: Created to load the data
              url: s3://snowflake-workshop-lab/
              file_format: S3_FILE_FORMAT              
              grants:
                ALL PRIVILEGES:
                  - ADMIN
                  - DATA_SCIENTIST
          file_formats:
            CITIBIKE_FORMAT:
              comment: "File format for type csv"
              format_type: CSV
              field_optionally_enclosed_by: '"'
              null_if:
                - ''
              grants:
                USAGE:
                  - ADMIN
                  - DATA_SCIENTIST
            S3_FILE_FORMAT:
              comment: "File format for type csv"
              format_type: CSV
              skip_header: 1
              field_delimiter: ","
              trim_space: true
              field_optionally_enclosed_by: '"'
              replace_invalid_characters: true
              date_format: "AUTO"
              time_format: "AUTO"
              timestamp_format: "AUTO"            
              grants:
                USAGE:
                  - ADMIN
                  - DATA_SCIENTIST
          tables:
            DIAMONDS:
              comment: "diamonds table"
              grants: *default_table_grants
              columns:
                "ROW":
                  type: NUMBER(38,0)
                CARAT: 
                  type: NUMBER(38,2)
                CUT: 
                  type: VARCHAR(16777216)
                COLOR: 
                  type: VARCHAR(16777216)
                CLARITY: 
                  type: VARCHAR(16777216)
                DEPTH: 
                  type: NUMBER(38,1)
                "TABLE":
                  type: NUMBER(38,1)
                PRICE: 
                  type: NUMBER(38,0)
                X: 
                  type: NUMBER(38,2)
                Y: 
                  type: NUMBER(38,2)
                Z: 
                  type: NUMBER(38,2)
            CITIBIKE_TRIPS_TABLE:
              comment: "citi bike table"
              grants: *default_table_grants
              columns:
                TRIPDURATION:
                  type: NUMBER(38,0)
                STARTTIME:
                  type: TIMESTAMP_NTZ(9)
                STOPTIME:
                  type: TIMESTAMP_NTZ(9)
                START_STATION_ID:
                  type: NUMBER(38,0)
                START_STATION_NAME:
                  type: VARCHAR(16777216)
                START_STATION_LATITUDE:
                  type: FLOAT
                START_STATION_LONGITUDE:
                  type: FLOAT
                END_STATION_ID:
                  type: NUMBER(38,0)
                END_STATION_NAME:
                  type: VARCHAR(16777216)
                END_STATION_LATITUDE:
                  type: FLOAT
                END_STATION_LONGITUDE:
                  type: FLOAT
                BIKEID:
                  type: NUMBER(38,0)
                MEMBERSHIP_TYPE:
                  type: VARCHAR(16777216)
                USERTYPE:
                  type: VARCHAR(16777216)
                BIRTH_YEAR:
                  type: NUMBER(38,0)
                GENDER:
                  type: NUMBER(38,0)
              orchestrators:
                stage_ingestion:
                  stage: CITIBIKE_LOAD
                  file_format: CITIBIKE_FORMAT
                  file_type: csv     # CSV, XML
                  path: citibike-trips-csv/trips_2018_7_7_0.csv.gz  # Path in the stage, not the bucket – remove any part of the path that is in the stage definition
                  truncate: true     # Truncate the table before ingesting
                  copy:          # Parameters added to the copy – in this case, to force the copy every run
                    on_error: "CONTINUE"  
            SUPPORT_TICKETS:
              comment: "support ticket table"
              grants: *default_table_grants
              columns:
                ticket_id: 
                  type: VARCHAR(60)
                customer_name: 
                  type: VARCHAR(60)
                customer_email: 
                  type: VARCHAR(60)
                service_type: 
                  type: VARCHAR(60)
                request: 
                  type: VARCHAR
                contact_preference: 
                  type: VARCHAR(60)
              orchestrators:
                stage_ingestion:
                  stage: S3_LOAD
                  file_format: S3_FILE_FORMAT
                  file_type: csv     # CSV, XML
                  path: finetuning_llm_using_snowflake_cortex_ai/  # Path in the stage, not the bucket – remove any part of the path that is in the stage definition
                  truncate: true     # Truncate the table before ingesting
            VEHICLES_TABLE:
              comment: "vehicles Table"
              grants: *default_table_grants
              columns:
                id:
                  type: NUMBER(38, 0)
                url:
                  type: VARCHAR
                region:
                  type: VARCHAR
                region_url:
                  type: VARCHAR
                price:
                  type: NUMBER(38, 0)
                year:
                  type: NUMBER(38, 0) 
                manufacturer:
                  type: VARCHAR 
                model:
                  type: VARCHAR 
                condition:
                  type: VARCHAR 
                cylinders:
                  type: VARCHAR 
                fuel:
                  type: VARCHAR 
                odometer:
                  type: NUMBER(38, 0)
                title_status:
                  type: VARCHAR
                transmission:
                  type: VARCHAR
                VIN:
                  type: VARCHAR
                drive:
                  type: VARCHAR
                size:
                  type: VARCHAR
                type:
                  type: VARCHAR
                paint_color:
                  type: VARCHAR
                image_url:
                  type: VARCHAR
                description:
                  type: VARCHAR
                county:
                  type: VARCHAR
                state:
                  type: VARCHAR
                lat:
                  type: NUMBER(38, 6)
                long: 
                  type: NUMBER(38, 6)
                posting_date:
                  type: VARCHAR
              orchestrators:
                stage_ingestion:
                  stage: S3_LOAD
                  file_format: S3_FILE_FORMAT
                  file_type: csv     # CSV, XML
                  path: misc/demos/vehicles.csv  # Path in the stage, not the bucket – remove any part of the path that is in the stage definition
                  truncate: true     # Truncate the table before ingesting
                  copy:          # Parameters added to the copy – in this case, to force the copy every run
                    on_error: "CONTINUE" 
            CAMPAIGN_SPEND:
              comment: "campaign spend table"
              grants: *default_table_grants
              columns:
                campaign: 
                  type: VARCHAR(60)
                channel: 
                  type: VARCHAR(60)
                date: 
                  type: DATE
                total_clicks: 
                  type: NUMBER(38,0)
                total_cost: 
                  type: NUMBER(38,0)
                ads_served: 
                  type: NUMBER(38,0)
              orchestrators:
                stage_ingestion:
                  stage: S3_LOAD
                  file_format: S3_FILE_FORMAT
                  file_type: csv     # CSV, XML
                  path: 'ad-spend-roi-snowpark-python-scikit-learn-streamlit/campaign_spend/'  # Path in the stage, not the bucket – remove any part of the path that is in the stage definition
                  truncate: true     # Truncate the table before ingesting 
            MONTHLY_REVENUE:
              comment: "monthly revenue table"
              grants: *default_table_grants
              columns:
                year: 
                  type: NUMBER(38,0)
                month: 
                  type: NUMBER(38,0)
                revenue: 
                  type: FLOAT
              orchestrators:
                stage_ingestion:
                  stage: S3_LOAD
                  file_format: S3_FILE_FORMAT
                  file_type: csv     # CSV, XML
                  path: 'ad-spend-roi-snowpark-python-scikit-learn-streamlit/monthly_revenue/'  # Path in the stage, not the bucket – remove any part of the path that is in the stage definition
                  truncate: true     # Truncate the table before ingesting 

  ## Grant access to the Snowflake's built-in metadata database.
  ## This is required for some reporting applications.
  SNOWFLAKE:
    namespacing: none
    manage_mode: grants
    grants:
      IMPORTED PRIVILEGES:
        - ADMIN

  ## Custom data share called EXAMPLE_SETUP_S
  # EXAMPLE_SETUP_S:
  #   namespacing: none
  #   manage_mode: grants
  #   grants:
  #     IMPORTED PRIVILEGES:
  #       - PUBLIC
